\documentclass[11pt,twoside,twocolumn]{usgsreport}
\usepackage{usgsfonts}
\usepackage{usgsgeo}
\usepackage{usgsidx}
\usepackage[tabletoc]{usgsreporta}

\usepackage{amsmath}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{bm}
\usepackage{calc}
\usepackage{natbib}
\usepackage{bibentry}
\usepackage{graphicx}
\usepackage{longtable}

\usepackage[T1]{fontenc}

\makeindex
\usepackage{setspace}
% uncomment to make double space 
%\doublespacing
\usepackage{etoolbox}
%\usepackage{verbatim}

\usepackage{titlesec}


\usepackage[hidelinks]{hyperref}
\hypersetup{
    pdftitle={MODFLOW~6 Release Notes},
    pdfauthor={MODFLOW~6 Development Team},
    pdfsubject={MODFLOW~6 Release Notes},
    pdfkeywords={MODFLOW, groundwater model, simulation},
    bookmarksnumbered=true,     
    bookmarksopen=true,         
    bookmarksopenlevel=1,       
    colorlinks=true,
    allcolors={blue},          
    pdfstartview=Fit,           
    pdfpagemode=UseOutlines,
    pdfpagelayout=TwoPageRight
}


\graphicspath{{./Figures/}}
\input{../version.tex}


\renewcommand{\cooperator}
{the \textusgs\ Water Availability and Use Science Program}
\renewcommand{\reporttitle}
{MODFLOW~6 Release Notes}
\renewcommand{\coverphoto}{coverimage.jpg}
\renewcommand{\GSphotocredit}{Binary computer code illustration.}
\renewcommand{\reportseries}{}
\renewcommand{\reportnumber}{}
\renewcommand{\reportyear}{2017}
\ifdef{\reportversion}{\renewcommand{\reportversion}{\currentmodflowversion}}{}
\renewcommand{\theauthors}{MODFLOW~6 Development Team}
\renewcommand{\thetitlepageauthors}{\theauthors}
%\renewcommand{\theauthorslastfirst}{}
\renewcommand{\reportcitingtheauthors}{MODFLOW~6 Development Team}
\renewcommand{\colophonmoreinfo}{}
\renewcommand{\theoffice}{Office of Groundwater \\ U.S. Geological Survey \\ Mail Stop 411 \\ 12201 Sunrise Valley Drive \\ Reston, VA 20192 \\ (703) 648-5001}
\renewcommand{\reportbodypages}{}
\urlstyle{rm}
\renewcommand{\reportwebsiteroot}{https://doi.org/10.5066/}
\renewcommand{\reportwebsiteremainder}{F76Q1VQV}
%\renewcommand{\doisecretary}{RYAN K. ZINKE}
%\renewcommand{\usgsdirector}{William H. Werkheiser}
%\ifdef{\usgsdirectortitle}{\renewcommand{\usgsdirectortitle}{Acting Director}}{}
\ifdef{\usgsissn}{\renewcommand{\usgsissn}{}}{}
\renewcommand{\theconventions}{}
\definecolor{coverbar}{RGB}{32, 18, 88}
\renewcommand{\bannercolor}{\color{coverbar}}
%\renewcommand{\thePSC}{the MODFLOW~6 Development Team}
%\renewcommand{\theeditor}{Christian D. Langevin}
%\renewcommand{\theillustrator}{None}
%\renewcommand{\thefirsttypesetter}{Joseph D. Hughes}
%\renewcommand{\thesecondtypesetter}{Cian Dawson}
\renewcommand{\reportrefname}{References Cited}

\makeatletter
\newcommand{\customlabel}[2]{%
   \protected@write \@auxout {}{\string \newlabel {#1}{{#2}{\thepage}{#2}{#1}{}} }%
   \hypertarget{#1}{}
}

\newcommand{\customcolophon}{
Publishing support provided by the U.S. Geological Survey \\
\theauthors
\newline \newline
For information concerning this publication, please contact:
\newline \newline
Office of Groundwater \\ U.S. Geological Survey \\ Mail Stop 411 \\ 12201 Sunrise Valley Drive \\ Reston, VA 20192 \\ (703) 648--5001 \\
https://water.usgs.gov/ogw/
}

\renewcommand{\reportrefname}{References Cited}
\newcommand{\inreferences}{%
\renewcommand{\theequation}{R--\arabic{equation}}%
\setcounter{equation}{0}%
\renewcommand{\thefigure}{R--\arabic{figure}}%
\setcounter{figure}{0}%
\renewcommand{\thetable}{R--\arabic{table}}%
\setcounter{table}{0}%
\renewcommand{\thepage}{R--\arabic{page}}%
\setcounter{page}{1}%
}

\newcounter{appendixno}
\setcounter{appendixno}{0}
\newcommand{\inappendix}{%
\addtocounter{appendixno}{1}%
\renewcommand{\theequation}{\Alph{appendixno}--\arabic{equation}}%
\setcounter{equation}{0}%
\renewcommand{\thefigure}{\Alph{appendixno}--\arabic{figure}}%
\setcounter{figure}{0}%
\renewcommand{\thetable}{\Alph{appendixno}--\arabic{table}}%
\setcounter{table}{0}%
\renewcommand{\thepage}{\Alph{appendixno}--\arabic{page}}%
\setcounter{page}{1}%
}

\nobibliography*

\begin{document}

%\makefrontcover
\ifdef{\makefrontcoveralt}{\makefrontcoveralt}{\makefrontcover}

%\makefrontmatter
%\maketoc
\ifdef{\makefrontmatterabv}{\makefrontmatterabv}{\makefrontmatter}

\onecolumn
\pagestyle{body}
\RaggedRight
\hbadness=10000
\pagestyle{body}
\setlength{\parindent}{1.5pc}

% -------------------------------------------------
\section{Introduction}
This document describes MODFLOW~6 Version \modflowversion.  This distribution is packaged for personal computers using the Microsoft Windows 7 and 10 operating systems, although it may run on other versions of Windows.  The executable file was compiled for 64-bit Windows operating systems and should run on most personal computers.

Version numbers for MODFLOW~6 will follow a major.minor.revision format.  The major number will be increased when there are substantial new changes that may break backward compatibility.  The minor number will be increased when important, but relatively minor new functionality is added.  The revision number will be added when errors are corrected in either the program or input files.

MODFLOW~6 is tested with a large number of example problems, and new capabilities are thoroughly tested as they are integrated into the program.  Additional testing can sometimes reveal errors in the program.  These errors are fixed as soon as possible and made available in a subsequent release.  Every effort is made to maintain backward compatibility of the format for MODFLOW~6 input files; however, this goal is not always possible, especially for newer packages and models.  Changes to the program to add new functionality, correct errors, or alter the format for an input file are summarized in this release notes document.

% -------------------------------------------------
\section{History}
This section describes changes introduced into MODFLOW~6 for the current release.  Changes introduced in previous releases are in Appendix~\ref{app:A}. These changes may substantially affect users.

\begin{itemize}
	\item Version mf6.2.1--February 18, 2021

	\underline{NEW FUNCTIONALITY}
	\begin{itemize}
	        \item The Source and Sink Mixing (SSM) Package for the Groundwater Transport Model was modified to include an alternative option for the concentration value assigned to sinks.  A new AUXMIXED option was added to represent evaporation-like sinks where the solute or a portion of the solute may be left behind.  The AUXMIXED option provides an alternative method for determining the groundwater sink concentration.  If the cell concentration is larger than the user-specified sink concentration, then the concentration of the sink will be assigned as the specified concentration.  Alternatively, if the specified concentration is larger than the cell concentration, then water will be withdrawn at the cell concentration.  Thus, the AUXMIXED option is designed to work with the Evapotranspiration and Recharge packages where water may be withdrawn at a concentration that is less than the cell concentration.  
	        \item Add support for the Freundlich and Langmuir isotherms to the Mass Storage and Transfer (MST) Package of the Groundwater Transport Model.
	\end{itemize}
	
	\underline{EXAMPLES}
	\begin{itemize}
	        \item Added the following new examples: 
	        \begin{itemize}
	          \item ex-gwt-mt3dms-p02
	          \item ex-gwt-rotate
	          \item ex-gwt-saltlake
	          \item ex-gwt-uzt-2d
	        \end{itemize}
	\end{itemize}

	\textbf{\underline{BUG FIXES AND OTHER CHANGES TO EXISTING FUNCTIONALITY}} \\
	\underline{BASIC FUNCTIONALITY}
	\begin{itemize}
	        \item The way in which the dispersion coefficients are calculated with the simple option (XT3D\_OFF) for the Dispersion Package was modified.  When the velocity within a cell is not aligned with a principal grid direction, the  dispersion coefficients are calculated using a simple arithmetic weighting, rather than harmonic weighting as is done for the simple option for anisotropic flow in the NPF Package.  The arithmetic weighting option eliminates a possible discontinuity when a principal flow-aligned dispersion component is zero.
	        \item The mass flow between two cells is calculated and optionally written to the GWT budget file.  There was an error in this calculation of mass flow when the TVD scheme was specified in the Advection (ADV) Package.  Consequently, the mass flows written to the budget file were not correct in this situation.  Because these mass flows are also used in the budget calculations for the Constant Concentration (CNC) Package, reported CNC mass flows were also not correct.  This could result in large budget discrepancies in the GWT budget table.  Simulated concentrations were not affected by this error.  A small correction was made to the routine that adds the advective mass flow for the TVD scheme.
	        \item Several packages had input blocks that could not be specified using the OPEN/CLOSE keyword.  The program was modified so that OPEN/CLOSE is supported for all intended blocks.
	        \item The Immobile domain Storage and Transfer (IST) Package for the GWT Model is based on a conceptual model in which the immobile domain is always fully saturated, and so the saturation of the immobile domain does not depend on head in a cell.  The program was modified so that none of the immobile domain terms include saturation, except for the mass transfer equation itself, in which the transfer of solute between the mobile and immobile domain is multiplied by the cell saturation.
	        \item Budget terms for the Immobile domain Storage and Transfer (IST) Package were not being written to the binary budget file for the GWT Model.  The package was modified to write these rate terms to the GWT binary budget file using the settings specified in the GWT Output Control file.
	        \item Bulk density does not need to be specified for the Immobile domain Storage and Transfer (IST) Package if sorption is not active; however the program was trying to access bulk density even though it is not needed, which resulted in an access violation.  Program was fixed so that bulk density does not need to be specified by the user unless sorption is active for the IST Package.
	        \item Budget tables printed to the listing file had numeric values that were missing the `E` character if the exponent had three digits (e.g. 1.e-100 or 1.e100).  Writing of the budget table was modified to include the `E` character in this case.  This change should make it easier for programs written in other languages to parse these tables.
	        \item In the Mass Transfer and Storage (MST) and the Immobile Storage and Transfer (IST) Packages, the keyword to activate sorption was changed from SORBTION to SORPTION.  The program will still accept SORBTION, but this keyword will be deprecated in the future.
	        \item Revised several of the text strings written to the headers within the GWT binary budget file.  A table of possible text strings for the GWT binary budget file are now included in the mf6io.pdf document.
	\end{itemize}

%	\underline{STRESS PACKAGES}
%	\begin{itemize}
%	        \item xxx  
%	        \item xxx  
%	        \item xxx  
%	\end{itemize}

	\underline{ADVANCED STRESS PACKAGES}
	\begin{itemize}
	        \item The CONSTANT term used to report the rate of mass provided by a constant-concentration condition in the LKT, SFT, MWT, and UZT did not include the contribution to adjacent package features.  For example, if a stream reach was marked as constant-concentration boundary and it had flow into a downstream reach, then that flow was not included in the budget calculations.  Consequently, reported budgets in the listing file would show discrepancies that were larger than what was actually simulated by the model.  The program code was modified to include these mass flows to adjacent features.
	        \item The ET formulation in UZF was not reducing the residual pET passed to deeper UZF objects when the extinction depth spanned multiple UZF objects (layers).  As a result, too much water was removed when the water table was shallow.  Or, in some cases, water was removed from dry cells that were above the water table but within the extinction depth interval. The ET code within the UZF package was modified to remove only eligible water from the unsaturated and saturated zones.
            \item The UZF package should exit with an appropriate error message when SURFDEP > cell thickness.  When this condition is not enforced, bad mass balances may result.  
            \item The FLOW\_IMBALANCE\_CORRECTION implemented in the GWT FMI Package did not work properly with the GWF UZF Package.  The issue was fixed by ensuring that the FMI Package could accurately calculate the flow residual for cells that had a UZF entry.
            \item The SFR package should exit with an appropriate error message when a diversion has a cprior type of FRACTION but the divflow value is outside the range 0.0 to 1.0 as stated in the documentation.
	\end{itemize}

%	\underline{SOLUTION}
%	\begin{itemize}
%	        \item xxx  
%	        \item xxx  
%	        \item xxx  
%	\end{itemize}

\end{itemize}


% -------------------------------------------------
\section{Known Issues}
This section describes known issues with this release of MODFLOW~6.  

\begin{enumerate}

\item
The AUXMULTNAME option can be used to scale input values, such as riverbed conductance, using values in an auxiliary column.  When this AUXMULTNAME option is used, the multiplier value in the AUXMULTNAME column should not be represented with a time series unless the value to scale is also represented with a time series.  

\item
The capability to use Unsaturated Zone Flow (UZF) routing beneath lakes and streams has not been implemented.

\item
Multi-point cross-section geometries have not been implemented in the Streamflow Routing (SFR) package.

\item
For the Groundwater Transport (GWT) Model, the decay and sorption processes do not apply to the LKT, SFT, MWT and UZT Packages.

\item
The GWT Model does not yet work with the CSUB Package of the GWF Model.  

\end{enumerate}

In addition to the issues shown here, a comprehensive and up-to-date list is available under the issues tab at \url{https://github.com/MODFLOW-USGS/modflow6}.


% -------------------------------------------------
\section{Distribution File}
The following distribution file is for use on personal computers: \texttt{\modflowversion.zip}.  The distribution file is a compressed zip file. The following directory structure is incorporated in the zip file:

% folder structured created by python script
\input{folder_struct.tex}

It is recommended that no user files are kept in the \modflowversion~directory structure.  If you do plan to put your own files in the \modflowversion~directory structure, do so only by creating additional subdirectories.

% -------------------------------------------------
\section{Installation and Execution}
There is no installation of MODFLOW~6 other than the requirement that \texttt{\modflowversion.zip} must be unzipped into a location where it can be accessed.  

To make the executable versions of MODFLOW~6 accessible from any directory, the directory containing the executables should be included in the PATH environment variable.  Also, if a prior release of MODFLOW~6 is installed on your system, the directory containing the executables for the prior release should be removed from the PATH environment variable.

As an alternative, the executable file, ``\texttt{mf6.exe}'', in the \modflowversion{}/bin directory can be copied into a directory already included in the PATH environment variable.

To run MODFLOW~6, simply type \texttt{mf6} in a terminal window.  The current working directory must be set to a location where the model input files are located.  Upon execution, MODFLOW~6 will immediately look for file with the name \texttt{mfsim.nam} in the current working directory, and will terminate with an error if it does not find this file.

% -------------------------------------------------
\section{Compiling MODFLOW~6}
MODFLOW~6 has been compiled using Intel Visual Fortran and gfortran on the Windows and Mac/OS operating systems.  Because the program uses relatively new Fortran extensions, newer versions of the compilers may be required for successful compilation.  For example, to use gfortran to compile MODFLOW~6, gfortran version 4.9 or newer must be used.  If you have gfortran installed on your computer, you can tell which version it is by entering ``\verb|gfortran --version|'' at a terminal window.

This distribution contains the Microsoft Visual Studio solution and project files for compiling MODFLOW~6 on Windows using the Intel Fortran Compiler.  The files have been used successfully with Microsoft Visual Studio Community 2019 and Intel(R) Visual Fortran Compiler 2020.0.166.  To compile MODFLOW~6, open the mf6.sln file in the msvs folder and click Build >  Build Solution.  A separate Visual Studio solution file is also included for building the BMI dynamically linked library version of MODFLOW~6.

This distribution also comes with a makefile for compiling MODFLOW~6 with \texttt{gfortran}.  The makefile is contained in the \texttt{make} folder.

For those familiar with Python, the pymake package can also be used to compile MODFLOW~6.  Additional information on the Python pymake utility can be found at: \url{https://github.com/modflowpy/pymake}.  

% -------------------------------------------------
\section{System Requirements}
MODFLOW~6 is written in Fortran.  It uses features from the 95, 2003, and 2008 language.  The code has been used on UNIX-based computers and personal computers running various forms of the Microsoft Windows operating system.

% -------------------------------------------------
\section{Testing}
The examples distributed with MODFLOW~6 can be run by navigating to the examples folder and executing the ``\texttt{run.bat}'' batch files within each example folder.  Alternatively, there is a ``\texttt{runall.bat}'' batch file under the examples folder that will run all of the test problems.

% -------------------------------------------------
\section{MODFLOW~6 Documentation}
Details on the numerical methods and the underlying theory for MODFLOW~6 are described in the following reports:

\begin{itemize}

\item \bibentry{modflow6framework}

\item \bibentry{modflow6gwf}

\item \bibentry{modflow6xt3d}

\end{itemize}
 
\noindent Description of the MODFLOW~6 input and output is included in this distribution in the ``doc'' folder as mf6io.pdf.

% -------------------------------------------------
\section{Disclaimer and Notices}

This software has been approved for release by the U.S. Geological Survey (USGS). Although the software has been subjected to rigorous review, the USGS reserves the right to update the software as needed pursuant to further analysis and review. No warranty, expressed or implied, is made by the USGS or the U.S. Government as to the functionality of the software and related material nor shall the fact of release constitute any such warranty. Furthermore, the software is released on condition that neither the USGS nor the U.S. Government shall be held liable for any damages resulting from its authorized or unauthorized use. Also refer to the USGS Water Resources Software User Rights Notice for complete use, copyright, and distribution information.

Notices related to this software are as follows:
\begin{itemize}
\item This software is a product of the U.S. Geological Survey, which is part of the U.S. Government.

\item This software is freely distributed. There is no fee to download and (or) use this software.

\item Users do not need a license or permission from the USGS to use this software. Users can download and install as many copies of the software as they need.

\item As a work of the United States Government, this USGS product is in the public domain within the United States. You can copy, modify, distribute, and perform the work, even for commercial purposes, all without asking permission. Additionally, USGS waives copyright and related rights in the work worldwide through CC0 1.0 Universal Public Domain Dedication (\url{https://creativecommons.org/publicdomain/zero/1.0/}).
\end{itemize}


\newpage
\ifx\usgsdirector\undefined
\addcontentsline{toc}{section}{\hspace{1.5em}\bibname}
\else
\inreferences
\REFSECTION
\fi
\input{bibliography.tex}


\newpage
\inappendix
\SECTION{Appendix A. Changes Introduced in Previous Versions}
\customlabel{app:A}{A}
\input{./appendixA.tex}


\justifying
\vspace*{\fill}
\clearpage
\pagestyle{backofreport}
\makebackcover
\end{document}
